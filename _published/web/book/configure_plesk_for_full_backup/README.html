<!DOCTYPE HTML>
<html lang="en-US" manifest="../manifest.appcache">
    
    <head>
        
        <meta charset="UTF-8">
        <title>Configure Plesk for Full Backup | Media Temple Amazon S3 Backup for DV (this works on other Linux servers too)</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 0.5.2">
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    
    
    
    <link rel="next" href="../automating_the_process/README.html" />
    
    
    <link rel="prev" href="../configure_amazon_access/README.html" />
    

        
    </head>
    <body>
        
        
<link rel="stylesheet" href="../gitbook/style.css">


        
    <div class="book"  data-level="3" data-basepath=".." data-revision="1406597186540">
    <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    
    <a href="https://github.com/null" target="_blank" class="btn pull-left home-bookmark" aria-label="GitHub home"><i class="fa fa-bookmark-o"></i></a>
    
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>
    <span id="font-settings-wrapper">
        <a href="#" class="btn pull-left toggle-font-settings" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="btn-group btn-block">
        <button id="reduce-font-size" class="btn btn-default">A</button>
        <button id="enlarge-font-size" class="btn btn-default">A</button>
    </div>

    <ul class="list-group font-family-list">
        <li class="list-group-item" data-font="0">Serif</li>
        <li class="list-group-item" data-font="1">Sans</li>
    </ul>

    <div class="btn-group btn-group-xs btn-block color-theme-list">
        <button type="button" class="btn btn-default" id="color-theme-preview-0" data-theme="0">White</button>
        <button type="button" class="btn btn-default" id="color-theme-preview-1" data-theme="1">Sepia</button>
        <button type="button" class="btn btn-default" id="color-theme-preview-2" data-theme="2">Night</button>
    </div>
</div>

    </span>

    <!-- Actions Right -->
    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Share on Google Plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Share on Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Share on Twitter"><i class="fa fa-twitter"></i></a>
    

    

    <!-- Title -->
    <h1>
        <i class="fa fa-spinner fa-spin"></i>
        <a href="../" >Media Temple Amazon S3 Backup for DV (this works on other Linux servers too)</a>
    </h1>
</div>

    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Search" class="form-control" />
    </div>
    <ul class="summary">
        
        

        

        

        

        <li data-level="0" data-path="index.html">
            <a href="../"><i class="fa fa-check"></i> Introduction</a>
        </li>
        
    
        <li class="chapter " data-level="1" data-path="prepare_the_server/README.html">
            
            <a href="../prepare_the_server/README.html">
                <i class="fa fa-check"></i> <b>1.</b> Prepare The Server
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="2" data-path="configure_amazon_access/README.html">
            
            <a href="../configure_amazon_access/README.html">
                <i class="fa fa-check"></i> <b>2.</b> Configure Amazon Access
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="3" data-path="configure_plesk_for_full_backup/README.html">
            
            <a href="../configure_plesk_for_full_backup/README.html">
                <i class="fa fa-check"></i> <b>3.</b> Configure Plesk for Full Backup
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="4" data-path="automating_the_process/README.html">
            
            <a href="../automating_the_process/README.html">
                <i class="fa fa-check"></i> <b>4.</b> Automating the Process
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="5" data-path="restoring_from_a_backup/README.html">
            
            <a href="../restoring_from_a_backup/README.html">
                <i class="fa fa-check"></i> <b>5.</b> Restoring From A Backup
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="6" data-path="taking_it_a_step_further/README.html">
            
            <a href="../taking_it_a_step_further/README.html">
                <i class="fa fa-check"></i> <b>6.</b> Taking It A Step Further
            </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1" data-path="taking_it_a_step_further/article.html">
            
            <a href="../taking_it_a_step_further/article.html">
                <i class="fa fa-check"></i> <b>6.1.</b> Configure Retention Policies
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="taking_it_a_step_further/configure_subscription_specific_vhost_backups.html">
            
            <a href="../taking_it_a_step_further/configure_subscription_specific_vhost_backups.html">
                <i class="fa fa-check"></i> <b>6.2.</b> Configure Subscription Specific (Vhost) Backups
            </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="7" data-path="getting_help/README.html">
            
            <a href="../getting_help/README.html">
                <i class="fa fa-check"></i> <b>7.</b> Getting Help
            </a>
            
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank" class="gitbook-link">Generated using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="page-wrapper" tabindex="-1">
                <div class="book-progress">
    <div class="bar">
        <div class="inner" style="width: 33.333333333333336%;min-width: 22.22222222222222%;"></div>
    </div>
    <div class="chapters">
    
        <a href="../index.html" title="Introduction" class="chapter done new-chapter" data-progress="0" style="left: 0%;"></a>
    
        <a href="../prepare_the_server/README.html" title="Prepare The Server" class="chapter done new-chapter" data-progress="1" style="left: 11.11111111111111%;"></a>
    
        <a href="../configure_amazon_access/README.html" title="Configure Amazon Access" class="chapter done new-chapter" data-progress="2" style="left: 22.22222222222222%;"></a>
    
        <a href="../configure_plesk_for_full_backup/README.html" title="Configure Plesk for Full Backup" class="chapter done new-chapter" data-progress="3" style="left: 33.333333333333336%;"></a>
    
        <a href="../automating_the_process/README.html" title="Automating the Process" class="chapter  new-chapter" data-progress="4" style="left: 44.44444444444444%;"></a>
    
        <a href="../restoring_from_a_backup/README.html" title="Restoring From A Backup" class="chapter  new-chapter" data-progress="5" style="left: 55.55555555555556%;"></a>
    
        <a href="../taking_it_a_step_further/README.html" title="Taking It A Step Further" class="chapter  new-chapter" data-progress="6" style="left: 66.66666666666667%;"></a>
    
        <a href="../taking_it_a_step_further/article.html" title="Configure Retention Policies" class="chapter  " data-progress="6.1" style="left: 77.77777777777777%;"></a>
    
        <a href="../taking_it_a_step_further/configure_subscription_specific_vhost_backups.html" title="Configure Subscription Specific (Vhost) Backups" class="chapter  " data-progress="6.2" style="left: 88.88888888888889%;"></a>
    
        <a href="../getting_help/README.html" title="Getting Help" class="chapter  new-chapter" data-progress="7" style="left: 100%;"></a>
    
    </div>
</div>

                <div class="page-inner">
                
                    <section class="normal" id="section-gitbook_13">
                    
                        <h1 id="configure-plesk-for-full-backup">Configure Plesk for Full Backup</h1>
<p>So this is going to be interesting on how this works… We are going to use the native Plesk Backup Manager, but we are going to choose the FTP solution and the server will essentially FTP the backup file to itself. Sounds very strange, but there are a few reasons why I did it this way which we will discover as we go through the set up.</p>
<p>Here is an image that essentially demonstrates our full server backup:</p>
<p><img src="../assets/07-AmazonBackup.gif" alt="Amazon Backup"></p>
<p>Now since we have the logic down, we have to create a Subscription to store our backups. But before we do that, we need to make sure that we have a Plan that will allow us to do that. Plesk would get quite emotional if we tried to store our 5GB backup in a plan that only allowed 1GB. To do this, select <em>Service Plans</em>, choose <em>Add New Plan</em>. Set the name to <em>S3 Backup</em> and make sure that you allow Unlimited storage a subscription and Traffic (you can choose whatever subdomain that you want). It would also be a wise choice to set the notifications to make sure that your subscription does not get out of control. Set these values to whatever you think suits your server best. Since our backups will be <em>MOVED</em> (not copy) to Amazon S3, we don’t have to worry about the subscription keeping an archive of backups.</p>
<p><img src="../assets/08-S3BackupPlan.png" alt="S3 Bucket Plan"></p>
<p>Once you have the Service Plan created, it’s now time to create the Subscription. You can use any domain that you would like, but it just has to <strong>exist and have the DNS properly pointed to your server’s IP address</strong>. Once you have your domain configured, create the Subscription and assign it to the new plan that we created.</p>
<p><img src="../assets/09-SubscriptionCreation.png" alt="Subscription Creation"></p>
<p>Once the subscription is created, let’s lock down that subscription so we don’t have any data leaks. We won’t be needing any web hosting, only FTP:</p>
<p><img src="../assets/10-DisableWebDomain.gif" alt="Subscription Creation"></p>
<p>Now that we have the web hosting disabled, we can create our directories for our backup (be sure to change the path to the domain name that you chose):</p>
<pre><code>mkdir -p /var/www/vhosts/backup.mysite.com/s3backups/fullserver
</code></pre><p>Before we get too excited, we need to make sure that our <code>backupuser</code> has ownership of the <code>s3backups</code> folder.</p>
<pre><code>chown -R backupuser:psacln /var/www/vhosts/backup.mysite.com/s3backups/
</code></pre><p>This directory that we just created is what we will be using to store our full server backups. We now need to create an FTP account that will have access only to this directory.</p>
<p><img src="../assets/11-FTPBackup.png" alt="FTP Backup"></p>
<p>The user is now configured, but we need to tell our server where to run the backup. Go to <em>Tools &amp; Settings</em> and then choose <em>Personal FTP Settings</em>. Here is where you can enter in the information that we just created. When you are filling this out, be sure to select <strong>FTPS</strong>. Even though we are sending it to ourselves, we want to make sure that we use <strong>FTPS</strong> to secure the transfer. Also, it is a wise idea to create an archive password. This is another step that will prevent unauthorized hands from getting on your data. <strong>Be sure to save these passwords in a safe place!</strong>:</p>
<p><img src="../assets/12-FTPSettings.png" alt="FTP Backup"></p>
<p>With the FTP settings set, we can now schedule our backup to run. Choosing the frequency of the backup is all up to you. Yes, Amazon is only pennies per GB, but it can add up fast if you are running large backups frequently. Go back to the <em>Backup Manager</em> then choose <em>Scheduled Backup Settings</em>.</p>
<p><img src="../assets/13-ScheduledBackupSettings.png" alt="Scheduled Backup Settings"></p>
<p>When you are configuring your settings, be sure that you click Activate at the top (many people forget to select that). Fill out the other fields anyway you want, but you can put in your email for notifications upon any errors (very good idea). Also, make sure that you select <em>All Configuration and Content</em> and make sure you uncheck the domain suspension. This will disable your sites while the backup runs. Only in special cases would you want that to happen.</p>
<p><img src="../assets/14-ScheduledSettings.png" alt="Schedule Settings"></p>
<h2 id="testing-the-backup">Testing The Backup</h2>
<p>We’re almost there! Now we can test it by choosing <em>Backup</em> from the Backup Manager.</p>
<p><img src="../assets/15-BackupButton.png" alt="Backup Button"></p>
<p>Here is where we can run our first test. Instead of backing up everything, lets just back up the server configuration. This will save A LOT of time in testing.</p>
<p><img src="../assets/16-BackupTest.png" alt="Backup Test"></p>
<p>It will start to run a backup. This is your cue to go grab another coffee/beer while it finishes. Once it is complete, you will see it appear in the Personal FTP tab:</p>
<p><img src="../assets/17-PersonalFTPTab.png" alt="Backup Tab"></p>
<p>Since that backup is done, lets see where it is at. We can check by running the <code>ll</code> or <code>ls</code> command:</p>
<pre><code>[root@myserver ~]# ll /var/www/vhosts/backup.mysite.com/s3backups/fullserver
total 284
-rw-r--r-- 1 backupuser psacln 287916 Apr  3 16:18 test_1404031618.tar
</code></pre><p>Now since the file is there, lets move it to Amazon S3. This is going to be the same command as our test from before, but we need to change the directory to the <em>fullserver</em> directory. You will see its output as it moves the file.</p>
<pre><code>[root@myserver ~]# aws s3 mv /var/www/vhosts/backup.mysite.com/s3backups/fullserver/ s3://myserver-pleskfull --recursive

move: ../var/www/vhosts/backup.mysite.com/s3backups/fullserver/test_1404031618.tar to s3://myserver-pleskfull/test_1404031618.tar
</code></pre><p>We can now list out the directory on the Amazon S3 bucket to confirm our file made it safely. When I run the command, you can see it shows our test text file as well:</p>
<pre><code>[root@myserver ~]# aws s3 ls s3://myserver-pleskfull --recursive
2014-04-03 12:13:13          0 test1.txt
2014-04-03 16:47:19     287916 test_1404031618.tar
</code></pre>
                    
                    </section>
                
                </div>
            </div>
        </div>

        
        <a href="../configure_amazon_access/README.html" class="navigation navigation-prev " aria-label="Previous page: Configure Amazon Access"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../automating_the_process/README.html" class="navigation navigation-next " aria-label="Next page: Automating the Process"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/jsrepl/jsrepl.js" id="jsrepl-script"></script>
<script src="../gitbook/app.js"></script>

    
    <script src="http://cdn.mathjax.org/mathjax/2.0-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
